<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script src="jquery-1.7.2.min.js" type="text/javascript"></script>

    <title>彩虹沙滩</title>
    <script type="text/javascript">

        var lastPathStack = [];
        var isShowImgVideo = false;

        // jQuery(function () {
        //     $('body').append('<div id="loading" src="/loading.gif" style="display:none;position:fixed;z-index:20202001;top:0;left:0;height:100%;width:100%;background: rgba(0,0,0,0.8) no-repeat fixed center;"></div>');

        // });


        $(function () {
            hideImgVideoContainer();
            lastPathStack.push("all");
            queryFiles("all");
            initBtnClick();
        });

        function queryFiles(path) {
            var now = new Date();
            var url = 'files' + '?' + "path=" + path;
            showLoading()
            $.getJSON(url, function (data) {
                console.log(data);
                $("#filelist").find("li").remove();
                if (data == null || data.length == 0) {
                    var $li = $('<li>' + "未找到文件" + '</li>');
                    $("#filelist").append($li);
                } else {
                    for (var i = 0; i < data.length; i++) {
                        var namePreStr = "【文件夹】"
                        var nameEndStr = ""
                        if (data[i].type == 1) {
                            namePreStr = "【图片】"
                        } else if (data[i].type == 2) {
                            namePreStr = "【视频】"
                        } else if (data[i].type == 3) {
                            namePreStr = "【文件夹】"
                            nameEndStr = ">>>"
                        } else {
                            namePreStr = "【文件】"
                        }
                        var $li = $('<li>' + namePreStr + "  " + data[i].name + nameEndStr + '</li>');
                        $li.attr("path", data[i].path);
                        $li.attr("type", data[i].type);
                        $("#filelist").append($li);
                        $li.click(function () {
                            var path = $(this).attr("path");
                            var type = $(this).attr("type");
                            console.log(path);
                            console.log(type);
                            if (type == 2) {
                                refreshImgViewShow(false);
                                refreshVideoViewShow(true);
                                var $video = $("#videoplayer");
                                $video.attr("src", "/files/" + path);
                                $video[0].play();
                            } else if (type == 1) {
                                refreshVideoViewShow(false);
                                refreshImgViewShow(true);
                                var $imgpalyer = $("#imgplayer");
                                $imgpalyer.attr("src", "/files/" + path);
                            } else if (type == 3) {
                                lastPathStack.push(path);
                                console.log("path 222 = " + path);
                                queryFiles(path);
                            } else {
                                checkAndDownLoadFile(path);
                            }
                        });
                    }
                }
                hideLoading();
            });
        };

        function refreshVideoViewShow(isShow) {
            if (isShow) {
                $("#img_video_container").css("display", "block");
                $("#videoplayer").css("display", "block");
                isShowImgVideo = true;
                document.getElementById("btnback").innerHTML = "关闭视频";
            } else {
                $("#videoplayer").css("display", "none");
            }
        }

        function refreshImgViewShow(isShow) {
            if (isShow) {
                $("#img_video_container").css("display", "block");
                $("#imgplayer").css("display", "block");
                isShowImgVideo = true;
                document.getElementById("btnback").innerHTML = "关闭图片";
            } else {
                $("#imgplayer").css("display", "none");
            }
        }

        function hideImgVideoContainer() {
            $("#videoplayer")[0].pause()
            $("#img_video_container").css("display", "none");
            $("#imgplayer").css("display", "none");
            $("#videoplayer").css("display", "none");
            $("#btnclose").css("display", "none");
            isShowImgVideo = false;
            document.getElementById("btnback").innerHTML = "后退";
        }


        function initBtnClick() {
            $("#btnback").click(function () {
                if (isShowImgVideo) {
                    hideImgVideoContainer();
                    return;
                }
                if (lastPathStack.length <= 1) {
                    return;
                }

                var lastpathTemp = lastPathStack[lastPathStack.length - 2];
                lastPathStack.pop();
                queryFiles(lastpathTemp)
            });

            $("#btnallfile").click(function () {
                hideImgVideoContainer();
                lastPathStack = ["all"]
                queryFiles("all");
            });

            $("#btnimg").click(function () {
                hideImgVideoContainer();
                lastPathStack = []
                queryFiles("images");
            });

            $("#btnvideo").click(function () {
                hideImgVideoContainer();
                lastPathStack = []
                queryFiles("videos");
            });

            $("#btn_close_img_video").click(function () {
                if (isShowImgVideo) {
                    hideImgVideoContainer();
                }
            });

        }


        function checkAndDownLoadFile(path) {
            var isToDownlaod = confirm("确定要下载该文件吗？");
            if (isToDownlaod) {
                // var url = 'downloadFile' + '?' + "path=" + path;
                var url = "/files/" + path;
                window.open(url);
                // $.getJSON(url, function (data) {
                //     console.log(data);
                //     if (data.code == 404) {
                //         alert("下载失败");
                //     }
                // });
            }
        }


        function showLoading() {
            $("#loading").show();
        }

        function hideLoading() {
            $("#loading").hide();
        }



    </script>
</head>

<body>
    <div id="root_container">
        <p style="margin-left: 20px; margin-top: 10px; font-size: 20px">
            <span style="color: #FF0000;">彩</span>
            <span style="color: #FF7F00;">虹</span>
            <span style="color: #FFFF00;">沙</span>
            <span style="color: #00FF00;">滩</span>
            <span style="color: #00FFFF;">开</span>
            <span style="color: #0000FF;">发</span>
            <span style="color: #8B00FF;">助</span>
            <span style="color: #000000;">手</span>
        </p>
        <button class="common_btn" id="btnback" type="button" style="background-color: #555555;">后退</button>
        <button class="common_btn" id="btnallfile" style="background-color: #555555;">查看所有文件</button>
        <button class="common_btn" id="btnimg" style="background-color: #555555;">查看图片</button>
        <button class="common_btn" id="btnvideo" style="background-color: #555555;">查看视频</button>
        <ul id="filelist" class="img-wrapper"></ul>
        <div id="img_video_container" class="img_video_container">
            <div id="btn_close_img_video" class="btn_close_img_video">关闭</div>
            <video class="videoplayer" id="videoplayer" controls="controls"></video>
            <img class="imgplayer" id="imgplayer" controls="controls"></img>
        </div>

        <div id="loading" class="loading_container">
            <div class="loading">

            </div>
        </div>
    </div>

</body>

<style>
    root_container {
        width: 100%;
        height: 100%;
        background-color: #fff;
    }

    .common_btn {
        width: 120px;
        height: 60px;
        text-align: center;
        margin-left: 10px;
        color: #fff;
        background-color: #555555;
    }


    ul {
        width: max-content;
        max-width: 50%;
        list-style-type: none;
    }



    .img_video_container {
        display: none;
        position: fixed;
        z-index: 20202001;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        background: rgba(0, 0, 0, 0.7);

    }

    .btn_close_img_video {
        position: absolute;
        right: 10px;
        top: 10px;
        width: 120px;
        height: 60px;
        background-color: #A493F4;
        border-radius: 30px;
        text-align: center;
        line-height: 60px;
        font-size: large;
        font-style: normal;
        color: #fff;
    }



    .videoplayer {
        max-width: 80%;
        max-height: 90%;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
        display: none;
    }

    .imgplayer {
        max-width: 80%;
        max-height: 90%;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
        display: none;
    }



    .loading_container {
        display: none;
        position: fixed;
        z-index: 20202001;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        background: rgba(0, 0, 0, 0.3);
    }


    .loading {
        width: 100px;
        height: 100px;
        border: 10px solid #fff;
        border-top-color: transparent;
        border-radius: 100%;
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
        margin: auto;
        animation: circle infinite 0.75s linear;
    }

    @keyframes circle {
        0% {
            transform: rotate(0);
        }

        100% {
            transform: rotate(360deg);
        }
    }


    .red-text {
        color: red;
    }

    .green-text {
        color: green;
    }

    .blue-text {
        color: blue;
    }
</style>


</html>